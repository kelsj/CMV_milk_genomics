#substitute 23 for X (bcf has 23 instead of X)
apex_exp.bot = apex_exp.bot %>% mutate(chr=ifelse(chr=="X",23,chr)) %>%
mutate(chr=as.integer(chr)) %>% arrange(chr,start)
apex_exp.bot
#save as tsv .bed: all inds, genes
write.table(apex_exp.bot, file=gzfile("apex_v3_bottomHalfRIN_rNormGeneQuants.bed.gz"),sep="\t",quote=F,row.names=F)
setwd("~/Documents/postdoc/milk_genomics/CMV/CMV_qPCR_from_HMOsExcess/")
setwd("~/Documents/postdoc/milk_genomics/CMV/CMV_qPCR_from_HMOsExcess/")
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(Hmisc)
library(ggcorrplot)
library(ggrepel)
library(readxl)
theme_set(theme_bw())
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds")
both.cmv.tot
## load qPCR results
qpcr = read_excel("UCSD_Results_Dr_Johnson.xlsx", sheet = 1)
qpcr
qpcr
colnames(qpcr) = c("study_id","cmv","copies.ml","copies.mg")
qpcr
qpcr %>% filter(study_id %in% both.cmv.tot$study_id)
both.cmv.tot
setwd("~/Documents/postdoc/milk_genomics/CMV/CMV_qPCR_from_HMOsExcess/")
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(Hmisc)
library(ggcorrplot)
library(ggrepel)
library(readxl)
theme_set(theme_bw())
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds")
## load qPCR results
qpcr = read_excel("UCSD_Results_Dr_Johnson.xlsx", sheet = 1)
colnames(qpcr) = c("study_id","cmv","copies.ml","copies.mg")
qpcr %>% filter(study_id %in% both.cmv.tot$study_id)
both.cmv.tot
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds") %>%
select(study_id,relAb)
both.cmv.tot
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds") %>%
select(study_id,relAb) %>% mutate(cmv=ifelse(relAb>0,"CMV+","CMV-"))
both.cmv.tot
table(both.cmv.tot$cmv)
both.cmv.tot %>% filter(study_id %in% qpcr$study_id)
qpcr %>% filter(study_id %in% both.cmv.tot$study_id)
both.cmv.tot %>% filter(study_id %in% qpcr$study_id)
milk.dat = read.csv("~/Documents/postdoc/milk_genomics/MILK_data/MILK_Study_Data_10.19.21_fromEllen.csv") %>% as_tibble() %>%
mutate(study_id=as.character(study_id)) %>% select(study_id, Center, parity, matage, mat_bmi, matrace, age_1,
delivery_cat, income_cat, wlz_1, gdm, infantrace) %>% distinct()
milk.dat %>% filter(study_id=="22799")
milk.dat %>% filter(study_id=="22779")
milk.dat
qpcr %>% filter(study_id=="22799")
qpcr %>% filter(study_id=="22779")
qpcr %>% filter(study_id=="22779")
#replace in qpcr with correct ID
qpcr = qpcr %>% mutate(study_id = ifelse(study_id=="22779", "22799", study_id))
qpcr %>% filter(study_id %in% both.cmv.tot$study_id) # N=186 samples overlap between datasets
both.cmv.tot
both.cmv.tot %>% left_join(qpcr)
qpcr
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml,0,copies.ml))),
copies.mg = ifelse(is.na(copies.mg,0,copies.mg)))
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg)))
comb.data
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))) %>% na.omit()
comb.data
qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))
both.cmv.tot
both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg)))
qpcr = read_excel("UCSD_Results_Dr_Johnson.xlsx", sheet = 1)
colnames(qpcr) = c("study_id","cmv.qpcr","copies.ml","copies.mg")
# one sample was numbered 22799 in manifest and 22779 on tube - error?
milk.dat = read.csv("~/Documents/postdoc/milk_genomics/MILK_data/MILK_Study_Data_10.19.21_fromEllen.csv") %>% as_tibble() %>%
mutate(study_id=as.character(study_id)) %>% select(study_id, Center, parity, matage, mat_bmi, matrace, age_1,
delivery_cat, income_cat, wlz_1, gdm, infantrace) %>% distinct()
milk.dat %>% filter(study_id=="22799") # exists
milk.dat %>% filter(study_id=="22779") # does not exist
#replace in qpcr with correct ID
qpcr = qpcr %>% mutate(study_id = ifelse(study_id=="22779", "22799", study_id))
qpcr %>% filter(study_id %in% both.cmv.tot$study_id) # N=187 samples overlap between datasets
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))) %>% na.omit()
comb.data
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relab))
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb))
# compare for positive samples only
ggplot(comb.data %>% filter(copies.ml>0 | relAb>0)) + geom_point(aes(x=copies.ml,y=relAb))
# compare for positive samples only
ggplot(comb.data %>% filter(cmv.qpcr=="Positive" | cmv=="CMV+")) + geom_point(aes(x=copies.ml,y=relAb))
# compare for positive samples only
ggplot(comb.data %>% filter(cmv.qpcr=="Positive" | cmv=="CMV+")) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
comb.data
comb.data %>% group_by(cmv,cmv.qpcr) %>% summarise(n=n())
comb.data %>% group_by(cmv,cmv.qpcr) %>% summarise(n=n()) %>% ungroup()
# compare for positive samples only
ggplot(comb.data %>% filter(cmv.qpcr=="Positive" | cmv=="CMV+")) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10)) +
scale_x_continuous(trans=scales::pseudo_log_trans(base = 10))
# compare for positive samples only
ggplot(comb.data %>% filter(cmv.qpcr=="Positive" | cmv=="CMV+")) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_y_continuous(trans=scales::pseudo_log_trans()) +
scale_x_continuous(trans=scales::pseudo_log_trans())
# compare for positive samples only
ggplot(comb.data %>% filter(cmv.qpcr=="Positive" | cmv=="CMV+")) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
comb.data %>% group_by(cmv,cmv.qpcr) %>% summarise(n=n()) %>% ungroup()
# calculate sens/spec and precision/accuracy of wgs/sms method
fpr = 7/(7+125)
fpr
fnr = 4/(4+51)
fnr
precision = 51/(51+7)
precision
recall = 51/(51+4)
recall
accuracy = (51+125)/nrow(comb.data)
accuracy
comb.data
table(comb.data$cmv)
58/nrow(comb.data)
table(comb.data$cmv.qpcr)
55/nrow(comb.data)
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_continuous(scales::pseudo_log_trans()) +
scale_y_continuous(scales::pseudo_log_trans())
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) #+
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_continuous(scales::pseudo_log_trans(base = 2)) +
scale_y_continuous(scales::pseudo_log_trans(base=2))
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_continuous(trans=scales::pseudo_log_trans(base = 10)) +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10))
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
comb.data
ggplot(comb.data) + geom_density(aes(x=log(relAb+1e-10)))
ggplot(comb.data) + geom_histogram(aes(x=relAb)) + scale_x_log10()
ggplot(comb.data) + geom_histogram(aes(x=relAb)) + scale_x_continuous(trans=scales::pseudo_log_trans(base = 10))
ggplot(comb.data) + geom_histogram(aes(x=log(relAb)))
ggplot(comb.data) + geom_histogram(aes(x=log(relAb+1e-10)))
comb.data
ggplot(comb.data) + geom_histogram(aes(x=log(copies.mg+1e-10)))
ggplot(comb.data) + geom_histogram(aes(x=log(copies.ml+1e-10)))
ggplot(comb.data) + geom_histogram(aes(x=log(copies.mg+1e-10)))
ggplot(comb.data) + geom_histogram(aes(x=log(copies.ml+1e-10)))
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=copies.mg)) +
scale_x_log10() + scale_y_log10()
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
comb.data
# correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
cor.test(comb.data$relAb, comb.data$copies.ml)
comb.data
# correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
cor.test(comb.data %>% filter(cmv=="CMV+") %>% pull(relAb), comb.data %>% filter(cmv=="CMV+") %>% pull(copies.ml))
# correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
cor.test(log(comb.data %>% filter(cmv=="CMV+") %>% pull(relAb)),
log(comb.data %>% filter(cmv=="CMV+") %>% pull(copies.ml)))
# correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
cor.test(log(comb.data %>% filter(cmv=="CMV+") %>% pull(relAb)),
log(comb.data %>% filter(cmv=="CMV+") %>% pull(copies.ml)),na.rm)
comb.data$relAb + 1e-10
# correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
cor.test(log(comb.data$relAb + 1e-10), log(comb.data$copies.ml + 1e-10))
comb.data
# only CMV+ samples
pos.both = comb.data %>% filter(cmv=="CMV+", cmv.qpcr=="Positive")
pos.both
cor.test(log(pos.both$relAb), log(pos.both$copies.ml))
# cor=0.8768998, t = 12.77, df = 49, p-value < 2.2e-16
cor.test(log(pos.both$relAb), log(pos.both$copies.mg))
comb.data %>% group_by(cmv,cmv.qpcr) %>% summarise(n=n()) %>% ungroup()
# cor=0.8278777, p-value = 6.738e-14
cor.test(log(pos.both$copies.ml), log(pos.both$copies.mg))
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10()
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads (shotgun sequencing)")
getwd()
ggsave("CMV_qPCR_vs_WGS_viralLoad.png",width=4,height=4)
ggsave("CMV_qPCR_vs_WGS_viralLoad.png",width=5,height=4)
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)")
ggsave("CMV_qPCR_vs_WGS_viralLoad.png",width=5,height=4)
## correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
# all samples
cor.test(log(comb.data$relAb + 1e-10), log(comb.data$copies.ml + 1e-10))
## correlation b/t copies.mg, copies.ml (both from qPCR) and proportion CMV-mapped reads
# all samples
cor.test(log(comb.data$relAb + 1e-10), log(comb.data$copies.ml + 1e-10))$p.value
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.89, P=2.4e-65")
cor.test(log(pos.both$relAb), log(pos.both$copies.ml))
wgs.qpcr.pos.corr = cor.test(log(pos.both$relAb), log(pos.both$copies.ml))
wgs.qpcr.pos.corr$p.value
wgs.qpcr.pos.corr
wgs.qpcr.pos.corr$p.value
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.88, P=3.3e-17")
ggsave("CMV_qPCR_vs_WGS_viralLoad.png",width=5,height=4)
ggsave("CMV_qPCR_vs_WGS_viralLoad.png",width=5,height=5)
ggplot(comb.data) + geom_histogram(aes(x=log(relAb+1e-10)))
comb.data
ggplot(comb.data) + geom_histogram(aes(x=log(relAb+1e-10), fill=cmv.qpcr),position="dodge")
ggplot(comb.data) + geom_histogram(aes(x=relAb, fill=cmv.qpcr),position="dodge")
ggplot(comb.data) + geom_histogram(aes(x=relAb, fill=cmv.qpcr),position="dodge") +
scale_y_log10()
ggplot(comb.data) + geom_histogram(aes(x=relAb, fill=cmv.qpcr),position="dodge")
ggplot(comb.data) + geom_histogram(aes(x=relAb, fill=cmv.qpcr),position="dodge") +
scale_y_log10()
ggplot(comb.data) + geom_histogram(aes(x=relAb, fill=cmv.qpcr),position="dodge")
# plot confusion matrix
library(ggpol)
comb.data
ggplot(comb.data) + geom_confmat(aes(x=cmv,y=cmv.qpcr))
comb.data
# edit columns
comb.data %>% mutate(qPCR = ifelse(cmv.qpcr=="Positive","CMV+","CMV-"), WGS = cmv)
# edit columns
comb.data = comb.data %>% mutate(qPCR = ifelse(cmv.qpcr=="Positive","CMV+","CMV-"), WGS = cmv)
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS))
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS), color="red")
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS), fill="red")
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS)) + scale_fill_gradient(low="lightblue",high="magenta")
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS)) + scale_fill_gradient(low="#FEFE62",high="#D35FB7")
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS)) + scale_fill_gradient(low="#FEFE62",high="#D35FB7") +
xlab("qPCR CMV status") + ylab("Shotgun sequencing CMV status")
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS)) + scale_fill_gradient(low="#FEFE62",high="#D35FB7") +
xlab("qPCR") + ylab("Shotgun sequencing")
ggsave("CMV_qPCR_vs_WGS_confusionMatrix.png", width=5,height=4)
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=copies.mg)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("CMV copies/mgDNA (qPCR)") +
ggtitle("Pearson's corr = 0.86, P=7.4e-16")
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=copies.mg)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("CMV copies/mgDNA (qPCR)") +
ggtitle("Pearson's corr = 0.86, P=7.4e-16")
ggsave("CMV_qPCR_mL_vs_mg_viralLoad.png",width=5,height=5)
ggplot(comb.data) + geom_confmat(aes(x=qPCR,y=WGS)) + scale_fill_gradient(low="#FEFE62",high="magenta") +
xlab("qPCR") + ylab("Shotgun sequencing")
comb.data
both.cmv.tot
readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds")
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds") %>%
select(study_id,relAb,sms.tot,wgs.tot) %>% mutate(cmv=ifelse(relAb>0,"CMV+","CMV-"))
both.cmv.tot
## load results from WGS/SMS
both.cmv.tot = readRDS("~/Documents/postdoc/milk_genomics/CMV/align_metagenomic_sensitivity/gencove_meta_milk1mo_cmv_cts_wRelAbQuantiles.rds") %>%
select(study_id,relAb,sms.tot,wgs.tot) %>% mutate(cmv=ifelse(relAb>0,"CMV+","CMV-")) %>%
mutate(source = ifelse(!is.na(sms.tot) & !is.na(wgs.tot),"both",ifelse(is.na(sms.tot),"WGS",ifelse(is.na(wgs.tot),"SMS","None"))))
both.cmv.tot
table(both.cmv.tot$source)
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))) %>% na.omit()
comb.data
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb,color=source)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.88, P=3.3e-17")
comb.data
table(comb.data %>% filter(cmv=="CMV+") %>% pull(source))
comb.data
both.cmv.tot
qpcr = read_excel("UCSD_Results_Dr_Johnson.xlsx", sheet = 1)
colnames(qpcr) = c("study_id","cmv.qpcr","copies.ml","copies.mg")
# one sample was numbered 22799 in manifest and 22779 on tube - error?
milk.dat = read.csv("~/Documents/postdoc/milk_genomics/MILK_data/MILK_Study_Data_10.19.21_fromEllen.csv") %>% as_tibble() %>%
mutate(study_id=as.character(study_id)) %>% select(study_id, Center, parity, matage, mat_bmi, matrace, age_1,
delivery_cat, income_cat, wlz_1, gdm, infantrace) %>% distinct()
milk.dat %>% filter(study_id=="22799") # exists
milk.dat %>% filter(study_id=="22779") # does not exist
#replace in qpcr with correct ID
qpcr = qpcr %>% mutate(study_id = ifelse(study_id=="22779", "22799", study_id))
qpcr %>% filter(study_id %in% both.cmv.tot$study_id) # N=187 samples overlap between datasets
comb.data = both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))) %>% na.omit()
comb.data
qpcr %>% filter(study_id %in% both.cmv.tot$study_id) # N=187 samples overlap between datasets
both.cmv.tot
both.cmv.tot %>% left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg)))
comb.data = both.cmv.tot %>% select(-sms.tot, -wgs.tot) %>%
left_join(qpcr %>% mutate(copies.ml = ifelse(is.na(copies.ml),0,copies.ml),
copies.mg = ifelse(is.na(copies.mg),0,copies.mg))) %>% na.omit()
comb.data
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb,color=source)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.88, P=3.3e-17")
# compare for positive samples only
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.88, P=3.3e-17")
ggplot(comb.data) + geom_point(aes(x=copies.ml,y=relAb,color=source)) +
scale_x_log10() + scale_y_log10() + xlab("CMV copies/mL (qPCR)") +
ylab("Proportion CMV-mapped reads\n(shotgun sequencing)") +
ggtitle("Pearson's corr = 0.88, P=3.3e-17")
ggsave("CMV_qPCR_vs_WGS_viralLoad_colorByShotgunType.png",width=5,height=5)
ggsave("CMV_qPCR_vs_WGS_viralLoad_colorByShotgunType.png",width=6,height=5)
## only CMV+ samples: compare wgs to 2 estimates from qPCR
pos.either = comb.data %>% filter(cmv=="CMV+" | cmv.qpcr=="Positive")
pos.either
wgs.qpcr.pos.corr = cor.test(log(pos.either$relAb), log(pos.either$copies.ml))
wgs.qpcr.pos.corr
summary(pos.either$relAb)
summary(pos.either$copies.ml)
wgs.qpcr.pos.corr = cor.test(log(pos.either$relAb + 1e-10), log(pos.either$copies.ml + 1e-10))
wgs.qpcr.pos.corr
ggplot(pos.either) + geom_point(aes(x=(relAb + 1e-10), y=(copies.ml + 1e-10)))
ggplot(pos.either) + geom_point(aes(x=(relAb + 1e-10), y=(copies.ml + 1e-10))) +
scale_x_log10() + scale_y_log10()
min.ab = min(pos.either$relAb)/2
min.cop = min(pos.either$copies.ml)/2
min.ab
min.cop
setwd("~/Documents/postdoc/milk_genomics/HMOs_july23/")
all.hmos = readRDS("combined_HMO_datasets_ug_ml.rds")
all.hmos
setwd("~/Documents/postdoc/milk_genomics/HMOs_july23/")
## HMO dataset 1
hmo1 = read_excel("~/Documents/postdoc/milk_genomics/MILK_data/HMOs GDM_nonGDM Report_MILK Study_Feb2021.xlsx") %>%
rename(study_id = `Sample#`) %>% mutate(study_id=as.character(study_id))
hmo1.ugml.cols = grep("_ug_ml",colnames(hmo1))
hmo1 = hmo1 %>% select(study_id, Secretor, all_of(hmo1.ugml.cols)) %>% select(-SUM_ug_ml)
colnames(hmo1) = str_replace_all(colnames(hmo1),"_ug_ml","")
hmo2 = read_excel("~/Documents/postdoc/milk_genomics/MILK_data/HMOs_July2023/230630 MN_Demerath_Report_KJedit_ug_ml.xlsx") %>%
mutate(study_id=as.character(study_id))
# both datasets have the same columns, slightly different order
colnames(hmo1)
colnames(hmo2)
# combined dataset: N=335
all.hmos = bind_rows(hmo1 %>% mutate(batch="A"), hmo2 %>% mutate(batch="B"))
all.hmos
# combined dataset: N=335
all.hmos = bind_rows(hmo1 %>% mutate(batch="A"), hmo2 %>% mutate(batch="B")) %>%
select(study_id,Secretor,batch,everything())
all.hmos
saveRDS(all.hmos, file="combined_HMO_datasets_ug_ml.rds")
pwd
getwd()
all.hmos
setwd("~/Documents/postdoc/milk_genomics/CMV/manuscript_drafts/code_to_share/CMV_milk_genomics/R/")
# load CMV status & addl metadata
metadata = read_excel("../data/CMV_milk_genomics_suppTables_v2.xlsx", sheet=1)
metadata
# load metabolite abundances
metabs = read.table("../data/metabolite_data.txt",header=T,sep="\t") %>% as_tibble()
metabs
metadata
metabs
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE)
kyn.meta.resid
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>% left_join(metadata %>% select(indID, Center))
metadata
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm))
kyn.meta.resid
metabs
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm)) %>%
na.omit()
kyn.meta.resid
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>% mutate(KYN = scale(log(KYNURENINE+1))) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm))
ktr.meta.resid$kyn.meta.resid = lm(KYN ~ Center + parity + matage + mat_bmi + mat.white + avg_totalhei + gdm, data=ktr.meta.resid)$residuals
kyn.meta.resid$KYNresid = lm(KYN ~ Center + parity + matage + mat_bmi + mat.white + avg_totalhei + gdm,
data=kyn.meta.resid)$residuals
ggplot(kyn.meta.resid, aes(x=milk.cmv.status,y=KYNresid,color=milk.cmv.status)) +
geom_boxplot(fill=NA,outlier.shape=NA,size=0.5) +
geom_beeswarm(cex=3,size=0.5,alpha=0.5) +
scale_color_manual(values=c("orange","slateblue")) +
xlab("") + ylab("Milk kynurenine\n(normalized abundance)") + theme(legend.position="None")
library(ggbeeswarm)
ggplot(kyn.meta.resid, aes(x=milk.cmv.status,y=KYNresid,color=milk.cmv.status)) +
geom_boxplot(fill=NA,outlier.shape=NA,size=0.5) +
geom_beeswarm(cex=3,size=0.5,alpha=0.5) +
scale_color_manual(values=c("orange","slateblue")) +
xlab("") + ylab("Milk kynurenine\n(normalized abundance)") + theme(legend.position="None")
kyn.meta.resid$KYNresid
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>% mutate(KYN = scale(log(KYNURENINE+1))) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm)) %>%
mutate_at(vars(avg_totalhei,matage,mat_bmi),scale) %>% mutate(Center=as.factor(Center))
metabs %>% select(indID, KYNURENINE) %>% mutate(KYN = scale(log(KYNURENINE+1))) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm))
metadata
# load CMV status & addl metadata
metadata = read_excel("../data/CMV_milk_genomics_suppTables_v2.xlsx", sheet=1, na = "NA")
metadata
#get residual kynurenine after regressing covariates
# 142 with all data points to calculate residuals
kyn.meta.resid = metabs %>% select(indID, KYNURENINE) %>% mutate(KYN = scale(log(KYNURENINE+1))) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm)) %>%
mutate_at(vars(avg_totalhei,matage,mat_bmi),scale) %>% mutate(Center=as.factor(Center))
kyn.meta.resid$KYNresid = lm(KYN ~ Center + parity + matage + mat_bmi + mat.white + avg_totalhei + gdm,
data=kyn.meta.resid)$residuals
ggplot(kyn.meta.resid, aes(x=milk.cmv.status,y=KYNresid,color=milk.cmv.status)) +
geom_boxplot(fill=NA,outlier.shape=NA,size=0.5) +
geom_beeswarm(cex=3,size=0.5,alpha=0.5) +
scale_color_manual(values=c("orange","slateblue")) +
xlab("") + ylab("Milk kynurenine\n(normalized abundance)") + theme(legend.position="None")
ggsave("../figs/fig3A.png",width=2,height=2.5)
# load TPM data
tpm = read.table("../data/milk_GeneExpr_TPM.txt", header=T, sep="\t") %>% as_tibble()
tpm
tpm %>% filter(gene_id=="ENSG00000131203")
tpm %>% filter(gene_id=="ENSG00000131203") %>% gather(key="indID",value="IDO1",2:222)
metadata
ido.dat = tpm %>% filter(gene_id=="ENSG00000131203") %>% gather(key="indID",value="IDO1",2:222) %>%
left_join(metadata %>% select(indID, milk.cmv.status))
ido.dat
my_y_title = bquote("Milk"~italic("IDO1")~"expression (TPM)")
ggplot(ido.dat, aes(y=IDO1,x=milk.cmv.status,color=milk.cmv.status)) +
geom_boxplot(outlier.shape=NA) +
geom_beeswarm(size=0.5,alpha=0.6,cex=2) +
scale_color_manual(values=c("orange","slateblue")) +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10)) +
ylab(my_y_title) + xlab("") + theme(legend.position="None")
left_join(metadata %>% select(indID, milk.cmv.status)) %>% filter(!is.na(milk.cmv.status)
ido.dat = tpm %>% filter(gene_id=="ENSG00000131203") %>% gather(key="indID",value="IDO1",2:222) %>%
ido.dat = tpm %>% filter(gene_id=="ENSG00000131203") %>% gather(key="indID",value="IDO1",2:222) %>%
left_join(metadata %>% select(indID, milk.cmv.status)) %>% filter(!is.na(milk.cmv.status))
my_y_title = bquote("Milk"~italic("IDO1")~"expression (TPM)")
ggplot(ido.dat, aes(y=IDO1,x=milk.cmv.status,color=milk.cmv.status)) +
geom_boxplot(outlier.shape=NA) +
geom_beeswarm(size=0.5,alpha=0.6,cex=2) +
scale_color_manual(values=c("orange","slateblue")) +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10)) +
ylab(my_y_title) + xlab("") + theme(legend.position="None")
ggsave("../figs/fig3B.png",width=2,height=2.5)
kyn.meta.resid = metabs %>% select(indID, KYNURENINE, TRYPTOPHAN) %>% mutate(KYN = scale(log(KYNURENINE+1))) %>%
left_join(metadata %>% select(indID, milk.cmv.status, Center, parity, matage, mat_bmi, mat.white, avg_totalhei, gdm)) %>%
mutate_at(vars(avg_totalhei,matage,mat_bmi),scale) %>% mutate(Center=as.factor(Center))
kyn.meta.resid$KYNresid = lm(KYN ~ Center + parity + matage + mat_bmi + mat.white + avg_totalhei + gdm,
data=kyn.meta.resid)$residuals
kyn.meta.resid
# calculate KTR ratio and get residuals after regression on covars
kyn.meta.resid = kyn.meta.resid %>% mutate(KTR=KYNURENINE/TRYPTOPHAN, KTR=scale(log(KTR)))
kyn.meta.resid
KTRresid
ido.dat
# add IDO1 tpm to metabolite data
kyn.meta.resid %>% left_join(ido.dat %>% select(indID, IDO1))
# add IDO1 tpm to metabolite data
kyn.meta.resid = kyn.meta.resid %>% left_join(ido.dat %>% select(indID, IDO1))
# plot
my_x_title = bquote("Milk"~italic("IDO1")~"expression (TPM, log10 scale)")
ggplot(kyn.meta.resid, aes(x=IDO1,y=KTRresid,color=milk.cmv.status)) + geom_smooth(method="lm",se=F) +
geom_point(size=0.75) + scale_color_manual(values=c("orange","slateblue")) +
xlab("Milk IDO1 expression\n(TPM, log10 scale)") +
ylab("Milk kynurenine/tryptophan \n(normalized ratio of abundances)") +
scale_x_continuous(trans=scales::pseudo_log_trans(base = 10)) +
theme(legend.pos="None", axis.title.x=element_text(size=rel(1.2)),axis.title.y=element_text(size=rel(1.2)))
# calculate KTR ratio and get residuals after regression on covars
kyn.meta.resid = kyn.meta.resid %>% mutate(KTR=KYNURENINE/TRYPTOPHAN, KTR=scale(log(KTR)))
kyn.meta.resid$KTRresid = lm(KTR ~ Center + parity + matage + mat_bmi + mat.white + avg_totalhei + gdm,
data=kyn.meta.resid)$residuals
# add IDO1 tpm to metabolite data
kyn.meta.resid = kyn.meta.resid %>% left_join(ido.dat %>% select(indID, IDO1))
ggplot(kyn.meta.resid, aes(x=IDO1,y=KTRresid,color=milk.cmv.status)) + geom_smooth(method="lm",se=F) +
geom_point(size=0.75) + scale_color_manual(values=c("orange","slateblue")) +
xlab("Milk IDO1 expression\n(TPM, log10 scale)") +
ylab("Milk kynurenine/tryptophan \n(normalized ratio of abundances)") +
scale_x_continuous(trans=scales::pseudo_log_trans(base = 10)) +
theme(legend.pos="None", axis.title.x=element_text(size=rel(1.2)),axis.title.y=element_text(size=rel(1.2)))
ggsave("../figs/fig3D.png",width=3.2,height=3.3)
